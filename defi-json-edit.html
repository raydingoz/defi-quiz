<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Defi ALS JSON EditÃ¶r</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050208;
      --card: #080b15;
      --border: #27272f;
      --accent: #f97373;
      --danger: #ef4444;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --heading: #fef2f2;
      --radius-lg: 16px;
      --radius-pill: 999px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 8px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #7f1d1d 0, #020617 40%, #000 100%);
      color: var(--text);
      font-size: 14px;
    }

    .app {
      max-width: 1120px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.4fr);
      gap: 10px;
    }

    @media (max-width: 900px) {
      .app {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--card);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: 10px;
      box-shadow: 0 14px 26px rgba(15,23,42,0.9);
      margin-top: 6px;
    }

    .title-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .brand {
      font-size: 0.98rem;
      font-weight: 700;
      color: var(--heading);
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .pill {
      border-radius: var(--radius-pill);
      border: 1px solid var(--border);
      padding: 3px 9px;
      font-size: 0.78rem;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(15,23,42,0.96);
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--danger);
      box-shadow: 0 0 10px rgba(239, 68, 68, 0.95);
    }

    .section-title {
      font-size: 0.86rem;
      font-weight: 600;
      color: var(--heading);
      margin: 4px 0 6px;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: minmax(0,1fr) minmax(0,1fr);
      gap: 6px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 2px;
      margin-bottom: 6px;
    }

    .field label {
      font-size: 0.78rem;
      color: var(--muted);
    }

    input[type="text"],
    input[type="number"],
    select,
    textarea {
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #020617;
      color: var(--text);
      padding: 6px 8px;
      font-size: 0.84rem;
      outline: none;
    }

    input[type="text"]::placeholder,
    textarea::placeholder {
      color: #6b7280;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .btn {
      border-radius: var(--radius-pill);
      border: 1px solid var(--border);
      padding: 6px 10px;
      font-size: 0.78rem;
      font-weight: 600;
      background: rgba(15,23,42,0.96);
      color: var(--muted);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: all 0.1s ease-out;
    }

    .btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .btn-main {
      background: radial-gradient(circle at top left, #f97373, #b91c1c);
      border: none;
      color: #fef2f2;
      box-shadow: 0 10px 22px rgba(239, 68, 68, 0.65);
    }

    .btn-danger {
      border-color: #7f1d1d;
      color: #fecaca;
      background: rgba(127,29,29,0.4);
    }

    .btn-sm {
      padding: 4px 8px;
      font-size: 0.75rem;
    }

    .info {
      font-size: 0.78rem;
      color: var(--muted);
      margin-top: 4px;
    }

    .info strong {
      color: var(--accent);
    }

    textarea.code {
      width: 100%;
      min-height: 260px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      font-size: 0.8rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border);
      font-size: 0.75rem;
      color: var(--muted);
      gap: 4px;
    }

    .badge span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .flex-between {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .small {
      font-size: 0.75rem;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- SOL: Meta + Olgu formu -->
    <div>
      <div class="card">
        <div class="title-bar">
          <div class="brand">Defi ALS JSON EditÃ¶r</div>
          <div class="pill">
            <span class="pill-dot"></span>
            <span id="sceneCounter">15 vaka</span>
          </div>
        </div>

        <div class="section-title">Genel ayarlar (meta)</div>
        <div class="grid-2">
          <div class="field">
            <label>Config adÄ±</label>
            <input type="text" id="metaNameInput" />
          </div>
          <div class="field">
            <label>Versiyon</label>
            <input type="text" id="metaVersionInput" />
          </div>
        </div>
        <div class="grid-2">
          <div class="field">
            <label>Player URL (QR buraya gider)</label>
            <input type="text" id="metaPlayerUrlInput" />
          </div>
          <div class="field">
            <label>Host URL</label>
            <input type="text" id="metaHostUrlInput" />
          </div>
        </div>

        <div class="section-title">Tema renkleri</div>
        <div class="grid-2">
          <div class="field">
            <label>Arka plan (bg)</label>
            <input type="text" id="themeBgInput" placeholder="#050208" />
          </div>
          <div class="field">
            <label>Kart (card)</label>
            <input type="text" id="themeCardInput" placeholder="#080b15" />
          </div>
        </div>
        <div class="grid-2">
          <div class="field">
            <label>SÄ±nÄ±r (border)</label>
            <input type="text" id="themeBorderInput" placeholder="#27272f" />
          </div>
          <div class="field">
            <label>Vurgu (accent)</label>
            <input type="text" id="themeAccentInput" placeholder="#f97373" />
          </div>
        </div>
        <div class="grid-2">
          <div class="field">
            <label>Danger</label>
            <input type="text" id="themeDangerInput" placeholder="#ef4444" />
          </div>
          <div class="field">
            <label>Metin (text)</label>
            <input type="text" id="themeTextInput" placeholder="#e5e7eb" />
          </div>
        </div>
        <div class="grid-2">
          <div class="field">
            <label>Muted</label>
            <input type="text" id="themeMutedInput" placeholder="#9ca3af" />
          </div>
          <div class="field">
            <label>BaÅŸlÄ±k (heading)</label>
            <input type="text" id="themeHeadingInput" placeholder="#fef2f2" />
          </div>
        </div>

        <div class="info small">
          Bu alanlarÄ± doldurman zorunlu deÄŸil; sadece temayÄ± kod tarafÄ±nda JSONâ€™dan okumak istersen kullanÄ±lÄ±r.
        </div>
      </div>

      <div class="card">
        <div class="flex-between">
          <div class="section-title">
            Olgu dÃ¼zenleyici
          </div>
          <div class="badge">
            <span class="dot"></span>
            <span id="currentSceneLabel">Olgu 1 / 15</span>
          </div>
        </div>

        <div class="grid-2">
          <div class="field">
            <label>Olgu ID</label>
            <input type="number" id="sceneIdInput" min="1" />
          </div>
          <div class="field">
            <label>Kategori</label>
            <select id="sceneCategoryInput">
              <option value="adult-als">adult-als</option>
              <option value="adult-trauma">adult-trauma</option>
              <option value="pediatric-als">pediatric-als</option>
              <option value="pediatric-trauma">pediatric-trauma</option>
              <option value="other">other</option>
            </select>
          </div>
        </div>

        <div class="grid-2">
          <div class="field">
            <label>YaÅŸ grubu</label>
            <select id="sceneAgeGroupInput">
              <option value="adult">adult</option>
              <option value="pediatric">pediatric</option>
            </select>
          </div>
          <div class="field">
            <label>SÃ¼re limiti (sn)</label>
            <input type="number" id="sceneTimeLimitInput" min="1" max="60" />
          </div>
        </div>

        <div class="field">
          <label>BaÅŸlÄ±k</label>
          <input type="text" id="sceneTitleInput" />
        </div>

        <div class="field">
          <label>Olgu metni</label>
          <textarea id="sceneTextInput"></textarea>
        </div>

        <div class="grid-2">
          <div class="field">
            <label>Ritim (wave)</label>
            <select id="sceneWaveInput">
              <option value="nsr">nsr (sinÃ¼s)</option>
              <option value="vf">vf</option>
              <option value="pvt">pvt</option>
              <option value="torsades">torsades</option>
              <option value="tachy">tachy</option>
              <option value="tachy-irreg">tachy-irreg</option>
              <option value="pea">pea</option>
              <option value="asystole">asystole</option>
            </select>
          </div>
          <div class="field">
            <label>DoÄŸru aksiyon</label>
            <select id="sceneCorrectActionInput">
              <option value="defib">defib (defibrilasyon)</option>
              <option value="cardioversion">cardioversion</option>
              <option value="no-shock">no-shock (ÅŸok yok)</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label>Faz (phase)</label>
          <input type="text" id="scenePhaseInput" placeholder="ResÃ¼sitasyon, NabÄ±zlÄ± taÅŸikardi, vb." />
        </div>

        <div class="field">
          <label>Tagâ€™ler (virgÃ¼lle ayÄ±r)</label>
          <input type="text" id="sceneTagsInput" placeholder="vf, trauma, pediatric, ..." />
        </div>

        <div class="btn-row">
          <button id="prevSceneBtn" class="btn btn-sm">â¬… Ã–nceki olgu</button>
          <button id="nextSceneBtn" class="btn btn-sm">Sonraki olgu â¡</button>
          <button id="addSceneBtn" class="btn btn-sm btn-main">ï¼‹ Yeni olgu ekle</button>
          <button id="deleteSceneBtn" class="btn btn-sm btn-danger">ğŸ—‘ Bu olguyu sil</button>
        </div>

        <div class="info small">
          Not: Olgu listesi sÄ±ralamasÄ±, JSONâ€™daki <strong>scenes</strong> dizisinin sÄ±rasÄ± ile aynÄ±dÄ±r. IDâ€™leri de dÃ¼zenleyebilirsin; kod tarafÄ±nda scene.idâ€™ye gÃ¶re Ã§alÄ±ÅŸtÄ±rmak istersen bu alanÄ± kullanÄ±rsÄ±n.
        </div>
      </div>
    </div>

    <!-- SAÄ: JSON Ã¶nizleme + aksiyonlar -->
    <div>
      <div class="card">
        <div class="flex-between">
          <div class="section-title">JSON Ã¶nizleme</div>
          <div class="btn-row">
            <button id="copyJsonBtn" class="btn btn-sm">ğŸ“‹ JSONâ€™u kopyala</button>
            <button id="downloadJsonBtn" class="btn btn-sm btn-main">ğŸ’¾ JSON indir</button>
          </div>
        </div>
        <textarea id="jsonOutput" class="code" spellcheck="false"></textarea>
        <div class="info small">
          Bu Ã§Ä±ktÄ±yÄ± doÄŸrudan projede <strong>config dosyasÄ±</strong> olarak kullanabilir, host/player kodunda
          JSONâ€™dan <code>meta</code> ve <code>scenes</code> okuyabilirsin.
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- VarsayÄ±lan JSON data ---
    const defaultData = {
      meta: {
        version: "1.0.0",
        name: "Defi-ALS-Workshop",
        playerUrl: "https://raydingoz.github.io/defi-quiz/defi-sim-player.html",
        hostUrl: "https://raydingoz.github.io/defi-quiz/defi-sim-host.html",
        theme: {
          bg: "#050208",
          card: "#080b15",
          border: "#27272f",
          accent: "#f97373",
          danger: "#ef4444",
          text: "#e5e7eb",
          muted: "#9ca3af",
          heading: "#fef2f2"
        }
      },
      scenes: [
        {
          id: 1,
          title: "Olgu 1 â€“ EriÅŸkin ani kollaps (OHCA)",
          category: "adult-als",
          ageGroup: "adult",
          tags: ["vf", "ohca", "defibrillation"],
          text: "58 yaÅŸ erkek, evde aniden kollabe oluyor. Olay yerinde yanÄ±tsÄ±z, normal solumuyor, nabÄ±z alÄ±namÄ±yor. Ekip KPR baÅŸlatÄ±yor ve acile getirilir getirilmez monitÃ¶re baÄŸlanÄ±yor.",
          wave: "vf",
          phase: "ResÃ¼sitasyon",
          correctAction: "defib",
          timeLimitSec: 6
        },
        {
          id: 2,
          title: "Olgu 2 â€“ Travma sonrasÄ± PEA",
          category: "adult-trauma",
          ageGroup: "adult",
          tags: ["trauma", "pea", "nonshockable"],
          text: "YÃ¼ksekten dÃ¼ÅŸme sonrasÄ± 40 yaÅŸ erkek acile getiriliyor. Åiddetli gÃ¶ÄŸÃ¼s ve batÄ±n travmasÄ± Ã¶ykÃ¼sÃ¼ var. MonitÃ¶rde organize elektriksel aktivite gÃ¶rÃ¼lÃ¼yor ancak nabÄ±z alÄ±namÄ±yor, hasta apneik ve yanÄ±tsÄ±z.",
          wave: "pea",
          phase: "Arrest deÄŸerlendirme",
          correctAction: "no-shock",
          timeLimitSec: 8
        },
        {
          id: 3,
          title: "Olgu 3 â€“ Hipotansif SVT",
          category: "adult-als",
          ageGroup: "adult",
          tags: ["svt", "unstable", "cardioversion"],
          text: "32 yaÅŸ kadÄ±n, Ã§arpÄ±ntÄ± ve gÃ¶ÄŸÃ¼s aÄŸrÄ±sÄ± ile geliyor. TA 70/40 mmHg, soÄŸuk ve terli, bilinÃ§ bulanÄ±k. NabÄ±z Ã§ok hÄ±zlÄ± ve dÃ¼zenli, geniÅŸ olmayan QRS kompleksleri var.",
          wave: "tachy",
          phase: "NabÄ±zlÄ± taÅŸikardi",
          correctAction: "cardioversion",
          timeLimitSec: 7
        },
        {
          id: 4,
          title: "Olgu 4 â€“ HÄ±zlÄ± AF, hipotansif",
          category: "adult-als",
          ageGroup: "adult",
          tags: ["af", "irregular", "cardioversion"],
          text: "74 yaÅŸ erkek, bilinen atriyal fibrilasyon Ã¶ykÃ¼sÃ¼ var. Bu kez hÄ±zlÄ± Ã§arpÄ±ntÄ±, nefes darlÄ±ÄŸÄ± ve baÅŸ dÃ¶nmesi ile geliyor. TA 80/50 mmHg, nabÄ±z dÃ¼zensiz hÄ±zlÄ±.",
          wave: "tachy-irreg",
          phase: "NabÄ±zlÄ± taÅŸikardi",
          correctAction: "cardioversion",
          timeLimitSec: 7
        },
        {
          id: 5,
          title: "Olgu 5 â€“ Asistol (travma dÄ±ÅŸÄ±)",
          category: "adult-als",
          ageGroup: "adult",
          tags: ["asystole", "nonshockable"],
          text: "Kronik hastalÄ±klarÄ± olan 82 yaÅŸ kadÄ±n, evde yanÄ±tsÄ±z bulunuyor. Acilde monitorize edildiÄŸinde dÃ¼z Ã§izgiye yakÄ±n elektriksel aktivite, nabÄ±z yok, normal solunum yok.",
          wave: "asystole",
          phase: "Arrest deÄŸerlendirme",
          correctAction: "no-shock",
          timeLimitSec: 6
        },
        {
          id: 6,
          title: "Olgu 6 â€“ NabÄ±zsÄ±z geniÅŸ kompleks VT",
          category: "adult-als",
          ageGroup: "adult",
          tags: ["pvt", "shockable", "defibrillation"],
          text: "50 yaÅŸ erkek, ÅŸiddetli gÃ¶ÄŸÃ¼s aÄŸrÄ±sÄ± sonrasÄ± acil bekleme alanÄ±nda yere yÄ±ÄŸÄ±lÄ±yor. NabÄ±z alÄ±namÄ±yor, normal solumuyor. MonitÃ¶rde hÄ±zlÄ±, geniÅŸ kompleksli ritim gÃ¶rÃ¼lÃ¼yor.",
          wave: "pvt",
          phase: "ResÃ¼sitasyon",
          correctAction: "defib",
          timeLimitSec: 6
        },
        {
          id: 7,
          title: "Olgu 7 â€“ Torsades de pointes",
          category: "adult-als",
          ageGroup: "adult",
          tags: ["torsades", "shockable", "magnesium"],
          text: "UzamÄ±ÅŸ QT Ã¶ykÃ¼sÃ¼ olan 45 yaÅŸ kadÄ±n, senkop sonrasÄ± acile getiriliyor. MonitÃ¶re alÄ±ndÄ±ÄŸÄ±nda morfolojisi ve amplitÃ¼dÃ¼ dalgalanan hÄ±zlÄ± bir ritim gÃ¶rÃ¼lÃ¼yor. NabÄ±z alÄ±namÄ±yor.",
          wave: "torsades",
          phase: "ResÃ¼sitasyon",
          correctAction: "defib",
          timeLimitSec: 7
        },
        {
          id: 8,
          title: "Olgu 8 â€“ ROSC sonrasÄ± ritim kontrolÃ¼",
          category: "adult-als",
          ageGroup: "adult",
          tags: ["rosc", "postshock", "nsr"],
          text: "VF nedeniyle defibrile edilen 60 yaÅŸ erkek hastada kÄ±sa sÃ¼re Ã¶nce ROSC saÄŸladÄ±nÄ±z. Hasta gÃ¶zlerini aÃ§Ä±yor, komut alÄ±yor. MonitÃ¶rde dÃ¼zenli bir ritim izleniyor.",
          wave: "nsr",
          phase: "Åok sonrasÄ± kontrol",
          correctAction: "no-shock",
          timeLimitSec: 6
        },
        {
          id: 9,
          title: "Olgu 9 â€“ Pediatrik VF (medikal arrest)",
          category: "pediatric-als",
          ageGroup: "pediatric",
          tags: ["pediatric", "vf", "defibrillation"],
          text: "10 yaÅŸ erkek Ã§ocuk, spor salonunda egzersiz sÄ±rasÄ±nda aniden kollabe oluyor. Olay yerinde KPR baÅŸlatÄ±lmÄ±ÅŸ, acile getirildiÄŸinde monitÃ¶re baÄŸlandÄ±ÄŸÄ±nda kaba titreÅŸimli kaotik bir ritim gÃ¶rÃ¼lÃ¼yor.",
          wave: "vf",
          phase: "Pediatrik resÃ¼sitasyon",
          correctAction: "defib",
          timeLimitSec: 7
        },
        {
          id: 10,
          title: "Olgu 10 â€“ Pediatrik asfiksi arrest (asistol)",
          category: "pediatric-als",
          ageGroup: "pediatric",
          tags: ["pediatric", "asphyxial", "asystole"],
          text: "2 yaÅŸ kÄ±z Ã§ocuk, uzun sÃ¼ren solunum sÄ±kÄ±ntÄ±sÄ± sonrasÄ± evde apneik ve yanÄ±tsÄ±z bulunuyor. Acilde monitÃ¶re baÄŸlandÄ±ÄŸÄ±nda dÃ¼z Ã§izgiye yakÄ±n elektriksel aktivite ve nabÄ±z yok.",
          wave: "asystole",
          phase: "Pediatrik resÃ¼sitasyon",
          correctAction: "no-shock",
          timeLimitSec: 8
        },
        {
          id: 11,
          title: "Olgu 11 â€“ Pediatrik SVT, kÃ¶tÃ¼ perfÃ¼zyon",
          category: "pediatric-als",
          ageGroup: "pediatric",
          tags: ["pediatric", "svt", "cardioversion"],
          text: "6 yaÅŸ erkek Ã§ocuk, Ã§arpÄ±ntÄ± ve halsizlik ile getiriliyor. TA dÃ¼ÅŸÃ¼k, kapiller dolum zamanÄ± uzamÄ±ÅŸ, Ã§ocuk soluk ve letarjik. MonitÃ¶rde dar QRS ile Ã§ok hÄ±zlÄ± dÃ¼zenli ritim gÃ¶rÃ¼lÃ¼yor.",
          wave: "tachy",
          phase: "Pediatrik nabÄ±zlÄ± taÅŸikardi",
          correctAction: "cardioversion",
          timeLimitSec: 7
        },
        {
          id: 12,
          title: "Olgu 12 â€“ Pediatrik travma arrest, PEA",
          category: "pediatric-trauma",
          ageGroup: "pediatric",
          tags: ["pediatric", "trauma", "pea"],
          text: "8 yaÅŸ Ã§ocuk, araÃ§ iÃ§i trafik kazasÄ± sonrasÄ± travmalÄ± olarak acile getiriliyor. Åiddetli gÃ¶ÄŸÃ¼s ve batÄ±n travmasÄ± var. MonitÃ¶rde organize elektriksel aktivite, fakat nabÄ±z yok ve Ã§ocuk apneik.",
          wave: "pea",
          phase: "Pediatrik travma arrest",
          correctAction: "no-shock",
          timeLimitSec: 8
        },
        {
          id: 13,
          title: "Olgu 13 â€“ Pediatrik travma, VF (defi dahil)",
          category: "pediatric-trauma",
          ageGroup: "pediatric",
          tags: ["pediatric", "trauma", "vf", "defibrillation"],
          text: "12 yaÅŸ erkek, elektrik akÄ±mÄ±na maruziyet sonrasÄ± travmalÄ± olarak acile getiriliyor. KÄ±sa sÃ¼re sonra nabÄ±z alÄ±namaz hale geliyor, KPR baÅŸlatÄ±lÄ±yor. MonitÃ¶rde kaotik, kaba titreÅŸimli hÄ±zlÄ± bir ritim gÃ¶rÃ¼lÃ¼yor.",
          wave: "vf",
          phase: "Pediatrik travma resÃ¼sitasyonu",
          correctAction: "defib",
          timeLimitSec: 7
        },
        {
          id: 14,
          title: "Olgu 14 â€“ GeniÅŸ kompleks taÅŸikardi, nabÄ±z var, instabil",
          category: "adult-als",
          ageGroup: "adult",
          tags: ["wide-tachy", "cardioversion"],
          text: "55 yaÅŸ erkek, Ã§arpÄ±ntÄ± ve gÃ¶ÄŸÃ¼s aÄŸrÄ±sÄ± ile acile geliyor. TA 80/50 mmHg, soluk ve terli, bilinÃ§ bulanÄ±k. MonitÃ¶rde geniÅŸ QRS'li dÃ¼zenli hÄ±zlÄ± ritim gÃ¶rÃ¼lÃ¼yor, nabÄ±z palpe edilebiliyor.",
          wave: "pvt",
          phase: "NabÄ±zlÄ± geniÅŸ kompleks taÅŸikardi",
          correctAction: "cardioversion",
          timeLimitSec: 7
        },
        {
          id: 15,
          title: "Olgu 15 â€“ Travma sonrasÄ± sinÃ¼s taÅŸikardisi",
          category: "adult-trauma",
          ageGroup: "adult",
          tags: ["trauma", "sinus-tachy", "no-shock"],
          text: "30 yaÅŸ erkek, motosiklet kazasÄ± sonrasÄ± acile getiriliyor. Bilinci aÃ§Ä±k ancak ajite, TA 90/60 mmHg, nabÄ±z 130/dk, soluk ve soÄŸuk. MonitÃ¶rde dar QRS'li dÃ¼zenli ritim, travmaya ve hipovolemiye sekonder sinÃ¼s taÅŸikardisi dÃ¼ÅŸÃ¼nÃ¼lÃ¼yor.",
          wave: "tachy",
          phase: "Travma resÃ¼sitasyonu",
          correctAction: "no-shock",
          timeLimitSec: 8
        }
      ]
    };

    let data = JSON.parse(JSON.stringify(defaultData));
    let currentSceneIndex = 0;

    // Meta alan referanslarÄ±
    const metaNameInput = document.getElementById("metaNameInput");
    const metaVersionInput = document.getElementById("metaVersionInput");
    const metaPlayerUrlInput = document.getElementById("metaPlayerUrlInput");
    const metaHostUrlInput = document.getElementById("metaHostUrlInput");

    const themeBgInput = document.getElementById("themeBgInput");
    const themeCardInput = document.getElementById("themeCardInput");
    const themeBorderInput = document.getElementById("themeBorderInput");
    const themeAccentInput = document.getElementById("themeAccentInput");
    const themeDangerInput = document.getElementById("themeDangerInput");
    const themeTextInput = document.getElementById("themeTextInput");
    const themeMutedInput = document.getElementById("themeMutedInput");
    const themeHeadingInput = document.getElementById("themeHeadingInput");

    // Scene alan referanslarÄ±
    const sceneCounter = document.getElementById("sceneCounter");
    const currentSceneLabel = document.getElementById("currentSceneLabel");

    const sceneIdInput = document.getElementById("sceneIdInput");
    const sceneCategoryInput = document.getElementById("sceneCategoryInput");
    const sceneAgeGroupInput = document.getElementById("sceneAgeGroupInput");
    const sceneTimeLimitInput = document.getElementById("sceneTimeLimitInput");
    const sceneTitleInput = document.getElementById("sceneTitleInput");
    const sceneTextInput = document.getElementById("sceneTextInput");
    const sceneWaveInput = document.getElementById("sceneWaveInput");
    const sceneCorrectActionInput = document.getElementById("sceneCorrectActionInput");
    const scenePhaseInput = document.getElementById("scenePhaseInput");
    const sceneTagsInput = document.getElementById("sceneTagsInput");

    // Butonlar
    const prevSceneBtn = document.getElementById("prevSceneBtn");
    const nextSceneBtn = document.getElementById("nextSceneBtn");
    const addSceneBtn = document.getElementById("addSceneBtn");
    const deleteSceneBtn = document.getElementById("deleteSceneBtn");
    const copyJsonBtn = document.getElementById("copyJsonBtn");
    const downloadJsonBtn = document.getElementById("downloadJsonBtn");

    const jsonOutput = document.getElementById("jsonOutput");

    function updateMetaForm() {
      const m = data.meta || {};
      metaNameInput.value = m.name || "";
      metaVersionInput.value = m.version || "";
      metaPlayerUrlInput.value = m.playerUrl || "";
      metaHostUrlInput.value = m.hostUrl || "";

      const t = m.theme || {};
      themeBgInput.value = t.bg || "";
      themeCardInput.value = t.card || "";
      themeBorderInput.value = t.border || "";
      themeAccentInput.value = t.accent || "";
      themeDangerInput.value = t.danger || "";
      themeTextInput.value = t.text || "";
      themeMutedInput.value = t.muted || "";
      themeHeadingInput.value = t.heading || "";
    }

    function applyMetaFromForm() {
      if (!data.meta) data.meta = {};
      const m = data.meta;
      m.name = metaNameInput.value.trim();
      m.version = metaVersionInput.value.trim();
      m.playerUrl = metaPlayerUrlInput.value.trim();
      m.hostUrl = metaHostUrlInput.value.trim();
      if (!m.theme) m.theme = {};
      const t = m.theme;
      t.bg = themeBgInput.value.trim();
      t.card = themeCardInput.value.trim();
      t.border = themeBorderInput.value.trim();
      t.accent = themeAccentInput.value.trim();
      t.danger = themeDangerInput.value.trim();
      t.text = themeTextInput.value.trim();
      t.muted = themeMutedInput.value.trim();
      t.heading = themeHeadingInput.value.trim();
    }

    function updateSceneForm() {
      const total = data.scenes.length;
      if (total === 0) {
        currentSceneLabel.textContent = "Olgu yok";
        sceneCounter.textContent = "0 vaka";
        return;
      }
      if (currentSceneIndex < 0) currentSceneIndex = 0;
      if (currentSceneIndex >= total) currentSceneIndex = total - 1;

      const s = data.scenes[currentSceneIndex];
      currentSceneLabel.textContent = `Olgu ${currentSceneIndex+1} / ${total}`;
      sceneCounter.textContent = `${total} vaka`;

      sceneIdInput.value = s.id ?? "";
      sceneCategoryInput.value = s.category || "adult-als";
      sceneAgeGroupInput.value = s.ageGroup || "adult";
      sceneTimeLimitInput.value = s.timeLimitSec ?? 6;
      sceneTitleInput.value = s.title || "";
      sceneTextInput.value = s.text || "";
      sceneWaveInput.value = s.wave || "nsr";
      sceneCorrectActionInput.value = s.correctAction || "no-shock";
      scenePhaseInput.value = s.phase || "";
      sceneTagsInput.value = (s.tags || []).join(", ");
    }

    function applySceneFromForm() {
      const total = data.scenes.length;
      if (total === 0) return;
      const s = data.scenes[currentSceneIndex];

      const idVal = parseInt(sceneIdInput.value, 10);
      s.id = Number.isFinite(idVal) ? idVal : s.id;

      s.category = sceneCategoryInput.value || "adult-als";
      s.ageGroup = sceneAgeGroupInput.value || "adult";

      const tl = parseInt(sceneTimeLimitInput.value, 10);
      s.timeLimitSec = Number.isFinite(tl) ? tl : s.timeLimitSec || 6;

      s.title = sceneTitleInput.value.trim();
      s.text = sceneTextInput.value.trim();
      s.wave = sceneWaveInput.value || "nsr";
      s.correctAction = sceneCorrectActionInput.value || "no-shock";
      s.phase = scenePhaseInput.value.trim();

      const tags = sceneTagsInput.value
        .split(",")
        .map(t => t.trim())
        .filter(t => t.length > 0);
      s.tags = tags;
    }

    function renderJson() {
      jsonOutput.value = JSON.stringify(data, null, 2);
    }

    // --- Event baÄŸlama ---

    // Meta inputlarÄ±
    [
      metaNameInput, metaVersionInput, metaPlayerUrlInput, metaHostUrlInput,
      themeBgInput, themeCardInput, themeBorderInput, themeAccentInput,
      themeDangerInput, themeTextInput, themeMutedInput, themeHeadingInput
    ].forEach(el => {
      el.addEventListener("input", () => {
        applyMetaFromForm();
        renderJson();
      });
    });

    // Scene inputlarÄ±
    [
      sceneIdInput, sceneCategoryInput, sceneAgeGroupInput, sceneTimeLimitInput,
      sceneTitleInput, sceneTextInput, sceneWaveInput, sceneCorrectActionInput,
      scenePhaseInput, sceneTagsInput
    ].forEach(el => {
      el.addEventListener("input", () => {
        applySceneFromForm();
        renderJson();
        updateSceneForm(); // ID/tags vs normalize olsun
      });
    });

    prevSceneBtn.addEventListener("click", () => {
      applySceneFromForm();
      if (currentSceneIndex > 0) currentSceneIndex--;
      updateSceneForm();
      renderJson();
    });

    nextSceneBtn.addEventListener("click", () => {
      applySceneFromForm();
      if (currentSceneIndex < data.scenes.length - 1) currentSceneIndex++;
      updateSceneForm();
      renderJson();
    });

    addSceneBtn.addEventListener("click", () => {
      applySceneFromForm();
      const newId = (data.scenes[data.scenes.length - 1]?.id || data.scenes.length) + 1;
      const newScene = {
        id: newId,
        title: "Yeni olgu",
        category: "adult-als",
        ageGroup: "adult",
        tags: [],
        text: "",
        wave: "nsr",
        phase: "",
        correctAction: "no-shock",
        timeLimitSec: 6
      };
      data.scenes.push(newScene);
      currentSceneIndex = data.scenes.length - 1;
      updateSceneForm();
      renderJson();
    });

    deleteSceneBtn.addEventListener("click", () => {
      if (data.scenes.length <= 1) {
        alert("En az 1 olgu kalmalÄ±.");
        return;
      }
      if (!confirm("Bu olguyu silmek istediÄŸine emin misin?")) return;
      data.scenes.splice(currentSceneIndex, 1);
      if (currentSceneIndex >= data.scenes.length) {
        currentSceneIndex = data.scenes.length - 1;
      }
      updateSceneForm();
      renderJson();
    });

    copyJsonBtn.addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(jsonOutput.value);
        alert("JSON panoya kopyalandÄ±.");
      } catch (e) {
        alert("Kopyalama baÅŸarÄ±sÄ±z oldu, elle seÃ§ip kopyalayabilirsin.");
      }
    });

    downloadJsonBtn.addEventListener("click", () => {
      const blob = new Blob([jsonOutput.value], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = (data.meta?.name || "defi-als-config") + ".json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    // BaÅŸlangÄ±Ã§ta formu yÃ¼kle
    function init() {
      updateMetaForm();
      updateSceneForm();
      renderJson();
    }
    init();
  </script>
</body>
</html>