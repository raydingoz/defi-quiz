<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Defibrilasyon SimÃ¼latÃ¶rÃ¼ â€“ ERC 2025 ALS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #020617;
      --card: #020617;
      --border: #1e293b;
      --accent: #22c55e;
      --danger: #f97373;
      --warning: #fbbf24;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --heading: #f9fafb;
      --radius-lg: 20px;
      --radius-pill: 999px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0f172a 0, #020617 50%, #000 100%);
      color: var(--text);
      font-size: 16px;
    }

    .shell {
      max-width: 960px;
      margin: 0 auto;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 1.4rem;
      color: var(--heading);
    }

    p {
      margin: 4px 0;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border);
      font-size: 0.75rem;
      color: var(--muted);
      background: rgba(15,23,42,0.95);
    }
    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 10px rgba(34,197,94,0.9);
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .card {
      background: linear-gradient(135deg, #020617 0%, #020617 100%);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: 12px 14px;
      box-shadow: 0 18px 35px rgba(15, 23, 42, 0.9);
      margin-top: 10px;
    }

    .layout {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    @media (min-width: 768px) {
      body { padding: 24px; }
      h1 { font-size: 1.6rem; }
      .layout { flex-direction: row; }
      .col-left { flex: 1.5; }
      .col-right { flex: 1; }
    }

    /* MONÄ°TÃ–R */

    .monitor-card { padding: 10px 12px; }

    .monitor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.85rem;
      margin-bottom: 4px;
      color: var(--muted);
    }

    .monitor-label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .monitor-led {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 12px rgba(34,197,94,0.9);
      animation: led-pulse 1.4s ease-in-out infinite;
    }

    .monitor-screen {
      border-radius: 16px;
      background: #000000;
      border: 1px solid #0f172a;
      padding: 8px 10px;
      position: relative;
      overflow: hidden;
    }

    .grid {
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(rgba(15,23,42,0.6) 1px, transparent 1px),
        linear-gradient(90deg, rgba(15,23,42,0.6) 1px, transparent 1px);
      background-size: 0.5rem 0.5rem;
      opacity: 0.5;
      pointer-events: none;
    }

    .ekg-line {
      position: relative;
      height: 60px;
      overflow: hidden;
    }

    .ekg-line::after {
      content: "";
      position: absolute;
      inset: 0;
      background-repeat: repeat-x;
      background-size: 120px 60px;
      background-position: 0 0;
      animation: ekg-scroll 0.55s linear infinite;
      filter: drop-shadow(0 0 6px #22c55e);
    }

    /* VF â€“ ince diÅŸli, fibrilatuar */
    .ekg-vf::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='60'%3E%3Cpolyline points='0,30 4,10 8,42 12,18 16,46 20,14 24,40 28,16 32,44 36,12 40,38 44,18 48,46 52,14 56,40 60,16 64,44 68,12 72,38 76,18 80,46 84,14 88,40 92,16 96,44 100,12 104,38 108,18 112,46 116,14 120,30' fill='none' stroke='%23f97373' stroke-width='1.8' stroke-linejoin='round'/%3E%3C/svg%3E");
    }

    /* pVT â€“ dÃ¼zenli geniÅŸ kompleks */
    .ekg-pvt::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='60'%3E%3Cpolyline points='0,30 6,12 12,48 18,12 24,48 30,12 36,48 42,12 48,48 54,12 60,48 66,12 72,48 78,12 84,48 90,12 96,48 102,12 108,48 114,12 120,30' fill='none' stroke='%23fb923c' stroke-width='2.1' stroke-linejoin='round'/%3E%3C/svg%3E");
    }

    /* Torsades de pointes â€“ amplitÃ¼dÃ¼ dalgalanan polimorfik VT */
    .ekg-torsades::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='60'%3E%3Cpolyline points='0,30 4,12 8,48 12,10 16,50 20,8 24,46 28,12 32,44 36,18 40,42 44,22 48,40 52,26 56,38 60,30 64,34 68,38 72,42 76,46 80,48 84,44 88,40 92,36 96,32 100,30 104,28 108,32 112,36 116,30 120,30' fill='none' stroke='%23fb7185' stroke-width='2' stroke-linejoin='round'/%3E%3C/svg%3E");
    }

    /* NSR â€“ dÃ¼zenli dar QRS */
    .ekg-nsr::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='60'%3E%3Cpolyline points='0,30 8,30 14,22 16,36 18,30 40,30 46,22 48,36 50,30 72,30 78,22 80,36 82,30 104,30 110,22 112,36 114,30 120,30' fill='none' stroke='%2322c55e' stroke-width='2' stroke-linejoin='round'/%3E%3C/svg%3E");
    }

    /* TaÅŸikardi â€“ dÃ¼zenli dar kompleks */
    .ekg-tachy::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='60'%3E%3Cpolyline points='0,30 4,18 6,36 8,30 20,30 24,18 26,36 28,30 40,30 44,18 46,36 48,30 60,30 64,18 66,36 68,30 80,30 84,18 86,36 88,30 100,30 104,18 106,36 108,30 120,30' fill='none' stroke='%23facc15' stroke-width='1.9' stroke-linejoin='round'/%3E%3C/svg%3E");
    }

    /* HÄ±zlÄ± AF â€“ dÃ¼zensiz */
    .ekg-tachy-irreg::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='60'%3E%3Cpolyline points='0,30 6,20 8,36 10,30 22,30 26,16 28,38 30,30 42,30 48,18 50,40 52,30 64,30 68,22 70,36 72,30 84,30 88,16 90,38 92,30 104,30 110,18 112,40 114,30 120,30' fill='none' stroke='%2381a7ff' stroke-width='1.8' stroke-linejoin='round'/%3E%3C/svg%3E");
    }

    /* Asistol â€“ dÃ¼z Ã§izgi */
    .ekg-asystole::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='60'%3E%3Cpolyline points='0,30 120,30' fill='none' stroke='%236b7280' stroke-width='2'/%3E%3C/svg%3E");
    }

    /* PEA â€“ dÃ¼ÅŸÃ¼k voltajlÄ±, organizeli */
    .ekg-pea::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='60'%3E%3Cpolyline points='0,32 10,32 16,28 18,36 20,32 34,32 40,28 42,36 44,32 58,32 64,28 66,36 68,32 82,32 88,28 90,36 92,32 106,32 112,28 114,36 116,32 120,32' fill='none' stroke='%2393c5fd' stroke-width='1.6' stroke-linejoin='round'/%3E%3C/svg%3E");
    }

    .monitor-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      margin-top: 4px;
      color: var(--muted);
    }

    .tag {
      padding: 2px 8px;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border);
      font-size: 0.75rem;
    }
    .tag-postshock {
      border-color: #22c55e;
      color: #bbf7d0;
      background: rgba(34,197,94,0.18);
    }

    /* KONTROLLER */

    .controls {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
    }

    .btn {
      border: none;
      border-radius: var(--radius-pill);
      padding: 12px 14px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s ease-out;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      outline: none;
      width: 100%;
    }

    .btn-main {
      background: radial-gradient(circle at top left, #fb923c, #f97316);
      color: #1f2933;
      box-shadow: 0 14px 28px rgba(248,113,22,0.45);
    }
    .btn-main:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 8px 16px rgba(248,113,22,0.4);
    }

    .btn-cardio {
      background: radial-gradient(circle at top left, #38bdf8, #0ea5e9);
      color: #0b1120;
      box-shadow: 0 14px 28px rgba(56,189,248,0.45);
    }
    .btn-cardio:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 8px 16px rgba(56,189,248,0.4);
    }

    .btn-sec {
      background: rgba(15,23,42,0.95);
      border: 1px solid var(--border);
      color: var(--muted);
    }
    .btn-sec:active {
      transform: translateY(1px);
    }

    .btn-next {
      margin-top: 4px;
      background: rgba(15,23,42,0.95);
      border: 1px solid var(--border);
      color: var(--muted);
      font-size: 0.9rem;
      padding: 8px 10px;
    }

    .btn-small {
      font-size: 0.8rem;
      padding: 6px 10px;
    }

    .btn[disabled] {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }

    .scenario-title {
      font-size: 0.95rem;
      color: var(--heading);
      margin-bottom: 4px;
    }

    .scenario-text {
      font-size: 0.9rem;
      color: var(--text);
      margin-bottom: 4px;
    }

    .feedback {
      margin-top: 6px;
      font-size: 0.9rem;
    }
    .feedback.ok { color: var(--accent); }
    .feedback.bad { color: var(--danger); }
    .feedback.info { color: var(--muted); }

    .meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
      margin-top: 4px;
    }

    .pill {
      border-radius: var(--radius-pill);
      padding: 3px 9px;
      border: 1px solid var(--border);
      font-size: 0.8rem;
      color: var(--muted);
    }

    .score-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .progress {
      margin-top: 6px;
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #22c55e, #4ade80);
      transform-origin: left;
      transition: width 0.25s ease-out;
    }

    /* Åok flash overlay */

    .shock-flash {
      position: fixed;
      inset: 0;
      background: #ffffff;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.15s ease-out;
      z-index: 999;
    }

    /* Animasyonlar */

    @keyframes ekg-scroll {
      from { background-position: 0 0; }
      to   { background-position: -120px 0; }
    }

    @keyframes led-pulse {
      0%, 100% { transform: scale(1); opacity: 0.9; }
      50% { transform: scale(1.3); opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="shock-flash" id="shockFlash"></div>

  <div class="shell">
    <div class="top-bar">
      <div>
        <h1>Defibrilasyon SimÃ¼latÃ¶rÃ¼</h1>
        <p>ERC 2025 ALS â€“ ritmi tanÄ±, 5 saniye iÃ§inde doÄŸru stratejiyi seÃ§.</p>
      </div>
      <div class="badge">
        <span class="badge-dot"></span>
        Defibrilasyon & kardiyoversiyon odaklÄ±
      </div>
    </div>

    <div class="layout">
      <!-- SOL: MONÄ°TÃ–R -->
      <div class="col-left">
        <div class="card monitor-card">
          <div class="monitor-header">
            <div class="monitor-label">
              <span class="monitor-led"></span>
              <span>Lead II</span>
            </div>
            <div>
              HR: <span id="rateLabel">â€“</span> â€¢
              SÃ¼re: <span id="timerLabel">5.0</span> sn
            </div>
          </div>

          <div class="monitor-screen">
            <div class="grid"></div>
            <div id="ekgLine" class="ekg-line ekg-vf"></div>
          </div>

          <div class="monitor-footer">
            <span id="phaseLabel" class="tag">TanÄ±klÄ± arrest</span>
            <span id="modeHint" class="tag">Ritim ekranÄ±</span>
          </div>
        </div>

        <div class="card">
          <div class="meta-row">
            <span class="pill score-pill">
              Skor:
              <strong id="scoreValue">0</strong> puan
            </span>
            <span class="pill">
              Olgu:
              <span id="sceneIndex">1</span>/<span id="sceneTotal">1</span>
            </span>
          </div>
          <div class="progress">
            <div id="progressFill" class="progress-fill"></div>
          </div>
        </div>
      </div>

      <!-- SAÄ: SENARYO & KONTROLLER -->
      <div class="col-right">
        <div class="card">
          <div class="scenario-title" id="scenarioTitle">
            Olgu 1 â€“ TanÄ±klÄ± VF arrest
          </div>
          <div class="scenario-text" id="scenarioText">
            Senaryo yÃ¼kleniyor...
          </div>

          <div class="controls">
            <button id="defibBtn" class="btn btn-main">
              âš¡ Defibrilasyon (200 J)
            </button>
            <button id="cardioBtn" class="btn btn-cardio">
              âš¡ Senkron kardiyoversiyon
            </button>
            <button id="noShockBtn" class="btn btn-sec">
              ğŸ¤š Åok yok / KPR / ilaÃ§
            </button>
            <button id="nextBtn" class="btn btn-next" disabled>
              Sonraki olguya geÃ§
            </button>
          </div>

          <div style="margin-top:8px; font-size:0.8rem; color:var(--muted);">
            Ä°leri seviye (opsiyonel): Bu olguda hangi ilaÃ§ Ã¶ncelikli?
          </div>
          <div class="controls" style="gap:6px; margin-top:4px;">
            <button id="epiBtn" class="btn btn-small btn-sec">ğŸ’Š Adrenalin</button>
            <button id="mgBtn" class="btn btn-small btn-sec">ğŸ’Š Magnezyum</button>
            <button id="lidoBtn" class="btn btn-small btn-sec">ğŸ’Š Lidokain / Amiodaron</button>
          </div>
          <div id="medFeedback" class="feedback info" style="font-size:0.8rem;">
            Ä°laÃ§ seÃ§imi puanÄ± deÄŸiÅŸtirmez, sadece geri bildirim verir.
          </div>

          <div id="feedback" class="feedback info" style="margin-top:8px;">
            Ritime bak, olguyu oku ve 5 sn iÃ§inde karar ver.
          </div>
        </div>

        <div class="card">
          <div class="scenario-title">SimÃ¼lasyonu sÄ±fÄ±rla</div>
          <p style="font-size:0.85rem; color:var(--muted); margin-bottom:6px;">
            Bu sayfa gerÃ§ek hasta yÃ¶netiminin yerini tutmaz; 2025 ALS algoritmasÄ±nÄ±
            tartÄ±ÅŸmak iÃ§in oyunlaÅŸtÄ±rÄ±lmÄ±ÅŸ bir araÃ§tÄ±r.
          </p>
          <button id="restartBtn" class="btn btn-small btn-sec">
            ğŸ” BaÅŸtan baÅŸlat
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const TIME_LIMIT_MS = 5000;

    // Olgular (defibrilasyon / kardiyoversiyon / ÅŸok yok + ilaÃ§lar)
    const SCENES = [
      {
        id: 1,
        title: "Olgu 1 â€“ TanÄ±klÄ± VF arrest",
        text: "65 yaÅŸ, tanÄ±klÄ± kardiyak arrest. MonitÃ¶rde kaba VFâ€™ye benzer, ince diÅŸli fibrilasyon. KPR baÅŸlatÄ±lmÄ±ÅŸ, defibrilatÃ¶r hazÄ±r.",
        wave: "vf",
        hr: "â€”",
        phase: "TanÄ±klÄ± arrest",
        correctAction: "defib",
        convertToNSR: true,
        postHr: "90",
        med: "lido",
        explanationOk:
          "VF ÅŸoklanabilir ritimdir. ERC 2025 ALS: MÃ¼mkÃ¼n olan en kÄ±sa sÃ¼rede defibrilasyon ve hemen ardÄ±ndan 2 dk kesintisiz KPR.",
        explanationBad:
          "VF / nabÄ±zsÄ±z VTâ€™de geciken defibrilasyon kÃ¶tÃ¼ prognozla iliÅŸkilidir. Bu tabloda Ã¶ncelik defibrilasyondur."
      },
      {
        id: 2,
        title: "Olgu 2 â€“ Åok sonrasÄ± ritim kontrolÃ¼",
        text: "Ä°lk ÅŸok ve 2 dk KPR sonrasÄ± kÄ±sa ritim kontrolÃ¼ndesin. MonitÃ¶rde organize, dar QRS ritmi var; hasta gÃ¶zÃ¼nÃ¼ aÃ§Ä±p hareket etmeye baÅŸlÄ±yor.",
        wave: "nsr",
        hr: "80",
        phase: "Åok sonrasÄ± ritim kontrolÃ¼",
        correctAction: "no-shock",
        convertToNSR: false,
        med: null,
        explanationOk:
          "Organize ritim ve klinik iyileÅŸme var. Ek ÅŸok verilmez; hemodinamik deÄŸerlendirme ve ileri yaÅŸam desteÄŸi planlanÄ±r.",
        explanationBad:
          "Organize ritimde ve hasta toparlarken tekrar defibrilasyon uygulanmaz; bu durumda ÅŸok vermek yanlÄ±ÅŸ olur."
      },
      {
        id: 3,
        title: "Olgu 3 â€“ Hemodinamik instabil SVT",
        text: "35 yaÅŸ, Ã§arpÄ±ntÄ±, hipotansiyon (TA 70/40), soÄŸuk ekstremiteler. MonitÃ¶rde dÃ¼zenli ve dar kompleks taÅŸikardi; nabÄ±z alÄ±nabiliyor.",
        wave: "tachy",
        hr: "190",
        phase: "TaÅŸikardi (nabÄ±z var)",
        correctAction: "cardioversion",
        convertToNSR: true,
        postHr: "90",
        med: null,
        explanationOk:
          "Hemodinamik instabil dar QRS SVT'de senkron kardiyoversiyon endikedir. 200 J defibrilasyon modu yerine senkronize ÅŸok tercih edilir.",
        explanationBad:
          "Bu tabloda defibrilasyon modu veya sadece beklemek/ilaÃ§la oyalanmak uygun deÄŸildir; hemodinamik instabil taÅŸikardide senkron kardiyoversiyon ilk seÃ§enektir."
      },
      {
        id: 4,
        title: "Olgu 4 â€“ HÄ±zlÄ± AF ve hipotansiyon",
        text: "72 yaÅŸ, bilinen AF. HÄ±zlÄ± ventrikÃ¼l yanÄ±tlÄ±, dÃ¼zensiz taÅŸikardi; TA 80/50, bilinÃ§ bulanÄ±k, gÃ¶ÄŸÃ¼s aÄŸrÄ±sÄ± var. NabÄ±z alÄ±nabiliyor.",
        wave: "tachy-irreg",
        hr: "150",
        phase: "TaÅŸikardi (nabÄ±z var)",
        correctAction: "cardioversion",
        convertToNSR: true,
        postHr: "90",
        med: null,
        explanationOk:
          "Hemodinamik instabil AF'de acil senkron kardiyoversiyon endikedir. Sadece ilaÃ§la yavaÅŸlatmaya Ã§alÄ±ÅŸmak gecikmeye yol aÃ§abilir.",
        explanationBad:
          "HÄ±zlÄ± AF ve hipotansiyonda beklemek veya sadece ilaÃ§la yetinmek uygun deÄŸildir; acil senkron kardiyoversiyon gerekir."
      },
      {
        id: 5,
        title: "Olgu 5 â€“ Asistol",
        text: "Hasta yanÄ±tsÄ±z, palpabl nabÄ±z yok. MonitÃ¶rde dÃ¼z Ã§izgiye yakÄ±n, gerÃ§ek asistol; farklÄ± derivasyonlar kontrol edilmiÅŸ.",
        wave: "asystole",
        hr: "0",
        phase: "Arrest ritmi",
        correctAction: "no-shock",
        convertToNSR: false,
        med: "epi",
        explanationOk:
          "Asistol ÅŸoklanamaz ritimdir. KPR, adrenalin ve geri dÃ¶nÃ¼ÅŸebilir nedenlerin (4H/4T) dÃ¼zeltilmesi esastÄ±r; defibrilasyon Ã¶nerilmez.",
        explanationBad:
          "Asistolde ÅŸok uygulamak sadece KPRâ€™yi keser ve zaman kaybettirir; ritim ÅŸoklanamaz olduÄŸu iÃ§in defibrilasyon etkili deÄŸildir."
      },
      {
        id: 6,
        title: "Olgu 6 â€“ PEA",
        text: "MonitÃ¶rde dÃ¼ÅŸÃ¼k voltajlÄ±, organize bir ritim var; ancak nabÄ±z alÄ±namÄ±yor. Klinik olarak arrest tablosu ile uyumlu.",
        wave: "pea",
        hr: "40",
        phase: "Arrest ritmi",
        correctAction: "no-shock",
        convertToNSR: false,
        med: "epi",
        explanationOk:
          "PEA ÅŸoklanamaz ritimdir. Tedavi KPR, adrenalin ve 4H/4Tâ€™ye yÃ¶nelik nedensel yaklaÅŸÄ±mdÄ±r.",
        explanationBad:
          "PEAâ€™de defibrilasyon etkin deÄŸildir. Åok yerine KPR ve altta yatan nedenlerin dÃ¼zeltilmesine odaklanÄ±lmalÄ±dÄ±r."
      },
      {
        id: 7,
        title: "Olgu 7 â€“ NabÄ±zsÄ±z VT",
        text: "GeniÅŸ QRS'li, dÃ¼zenli ritim; palpabl nabÄ±z yok. NabÄ±zsÄ±z VT olarak deÄŸerlendiriyorsun.",
        wave: "pvt",
        hr: "160",
        phase: "Arrest ritmi",
        correctAction: "defib",
        convertToNSR: true,
        postHr: "90",
        med: "lido",
        explanationOk:
          "NabÄ±zsÄ±z VT ÅŸoklanabilir ritimdir. Defibrilasyon + ardÄ±ndan 2 dk KPR, uygun zamanda adrenalin ve amiodaron/lidokain ile yÃ¶netilir.",
        explanationBad:
          "NabÄ±zsÄ±z VTâ€™de defibrilasyondan kaÃ§Ä±nmak veya sadece ilaÃ§/KPR ile yetinmek uygun deÄŸildir; ÅŸok gecikmesi prognozu bozar."
      },
      {
        id: 8,
        title: "Olgu 8 â€“ Torsades de pointes",
        text: "UzamÄ±ÅŸ QT Ã¶ykÃ¼sÃ¼ olan bir hastada, senkronize olmayan polimorfik VT benzeri ritim; amplitÃ¼d dalgalanÄ±yor. NabÄ±z alÄ±namÄ±yor.",
        wave: "torsades",
        hr: "220",
        phase: "Arrest ritmi (torsades)",
        correctAction: "defib",
        convertToNSR: true,
        postHr: "90",
        med: "mg",
        explanationOk:
          "Torsades de pointes genellikle uzamÄ±ÅŸ QT zemininde geliÅŸen polimorfik VTâ€™dir. NabÄ±zsÄ±z tabloda defibrilasyon + magnezyum replasmanÄ± uygundur.",
        explanationBad:
          "Torsadesâ€™te magnezyum replasmanÄ± kritik; nabÄ±z yoksa defibrilasyon da gerekir. Sadece adrenalin ya da lidokain ile yetinmek doÄŸru deÄŸildir."
      }
    ];

    const ekgLine = document.getElementById("ekgLine");
    const rateLabel = document.getElementById("rateLabel");
    const phaseLabel = document.getElementById("phaseLabel");
    const modeHint = document.getElementById("modeHint");
    const timerLabel = document.getElementById("timerLabel");

    const scenarioTitle = document.getElementById("scenarioTitle");
    const scenarioText = document.getElementById("scenarioText");
    const scoreValue = document.getElementById("scoreValue");
    const sceneIndex = document.getElementById("sceneIndex");
    const sceneTotal = document.getElementById("sceneTotal");
    const progressFill = document.getElementById("progressFill");
    const feedback = document.getElementById("feedback");
    const medFeedback = document.getElementById("medFeedback");

    const defibBtn = document.getElementById("defibBtn");
    const cardioBtn = document.getElementById("cardioBtn");
    const noShockBtn = document.getElementById("noShockBtn");
    const nextBtn = document.getElementById("nextBtn");
    const restartBtn = document.getElementById("restartBtn");
    const shockFlash = document.getElementById("shockFlash");

    const epiBtn = document.getElementById("epiBtn");
    const mgBtn = document.getElementById("mgBtn");
    const lidoBtn = document.getElementById("lidoBtn");

    let currentIndex = 0;
    let score = 0;
    let locked = false;
    let timerInterval = null;
    let deadline = null;
    const baseTimerColor = getComputedStyle(timerLabel).color;

    sceneTotal.textContent = SCENES.length;

    function updateMonitor(scene, fromShockSuccess = false) {
      ekgLine.className = "ekg-line";
      const wave = scene.wave || "nsr";
      ekgLine.classList.add("ekg-" + wave);

      rateLabel.textContent = scene.hr ? scene.hr : "â€“";
      phaseLabel.textContent = scene.phase || "";

      if (fromShockSuccess && wave === "nsr") {
        modeHint.textContent = "Ritim organize oldu";
        modeHint.className = "tag tag-postshock";
      } else {
        modeHint.textContent = "Ritim ekranÄ±";
        modeHint.className = "tag";
      }
    }

    function resetTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      timerLabel.style.color = baseTimerColor;
    }

    function startTimer() {
      resetTimer();
      deadline = Date.now() + TIME_LIMIT_MS;
      timerLabel.style.color = baseTimerColor;

      function tick() {
        if (locked) {
          resetTimer();
          return;
        }
        const now = Date.now();
        const remaining = deadline - now;
        if (remaining <= 0) {
          resetTimer();
          timerLabel.textContent = "0.0";
          timerLabel.style.color = baseTimerColor;
          handleTimeout();
        } else {
          const sec = remaining / 1000;
          timerLabel.textContent = sec.toFixed(1);
          if (sec <= 2) {
            timerLabel.style.color = "#f97373";
          } else {
            timerLabel.style.color = baseTimerColor;
          }
        }
      }

      timerLabel.textContent = (TIME_LIMIT_MS / 1000).toFixed(1);
      timerInterval = setInterval(tick, 100);
    }

    function renderScene() {
      const s = SCENES[currentIndex];
      sceneIndex.textContent = currentIndex + 1;
      scenarioTitle.textContent = s.title;
      scenarioText.textContent = s.text;

      const progress = (currentIndex / SCENES.length) * 100;
      progressFill.style.width = progress + "%";

      feedback.textContent = "Ritime bak, olguyu oku ve 5 sn iÃ§inde karar ver.";
      feedback.className = "feedback info";
      medFeedback.textContent = "Ä°laÃ§ seÃ§imi puanÄ± deÄŸiÅŸtirmez, sadece geri bildirim verir.";
      medFeedback.className = "feedback info";

      locked = false;
      nextBtn.disabled = true;

      updateMonitor(s);
      startTimer();
    }

    function triggerShockFlash(actionType) {
      if (actionType === "cardioversion") {
        shockFlash.style.background = "#e0f2fe";
      } else {
        shockFlash.style.background = "#ffffff";
      }
      shockFlash.style.opacity = "1";
      setTimeout(() => {
        shockFlash.style.opacity = "0";
      }, 120);
    }

    function handleAction(actionType) {
      if (locked) return;
      const s = SCENES[currentIndex];
      locked = true;
      nextBtn.disabled = false;
      resetTimer();

      const isCorrect = actionType === s.correctAction;
      let delta = 0;

      if (isCorrect) {
        delta = 10;
        score += delta;
        feedback.textContent = s.explanationOk || "DoÄŸru.";
        feedback.className = "feedback ok";
      } else {
        delta = -5;
        score += delta;
        if (score < 0) score = 0;
        feedback.textContent = s.explanationBad || "YanlÄ±ÅŸ karar.";
        feedback.className = "feedback bad";
      }
      scoreValue.textContent = score;

      if (actionType === "defib" || actionType === "cardioversion") {
        triggerShockFlash(actionType);

        if (s.convertToNSR && isCorrect) {
          setTimeout(() => {
            const postScene = {
              wave: "nsr",
              hr: s.postHr || "80",
              phase: "Åok sonrasÄ±"
            };
            updateMonitor(postScene, true);
          }, 350);
        }
      }

      if (currentIndex === SCENES.length - 1) {
        nextBtn.textContent = "Oturumu bitir";
      } else {
        nextBtn.textContent = "Sonraki olguya geÃ§";
      }
    }

    function describeActionKey(key) {
      if (key === "defib") return "defibrilasyon";
      if (key === "cardioversion") return "senkron kardiyoversiyon";
      if (key === "no-shock") return "ÅŸok yok / KPR / ilaÃ§";
      return "uygun yaklaÅŸÄ±m";
    }

    function handleTimeout() {
      if (locked) return;
      locked = true;
      nextBtn.disabled = false;

      const s = SCENES[currentIndex];
      const correctText = describeActionKey(s.correctAction);
      feedback.textContent =
        "SÃ¼re doldu. Bu olguda doÄŸru yaklaÅŸÄ±m: " + correctText + ". " +
        (s.explanationOk || "");
      feedback.className = "feedback bad";
    }

    function medLabel(code) {
      if (code === "epi") return "adrenalin";
      if (code === "mg") return "magnezyum";
      if (code === "lido") return "amiodaron / lidokain";
      return "uygun ilaÃ§";
    }

    function handleMed(choice) {
      const s = SCENES[currentIndex];
      if (!s.med) {
        medFeedback.textContent =
          "Bu olguda asÄ±l kritik olan enerji stratejisi (defibrilasyon / kardiyoversiyon); ilaÃ§ seÃ§imi ikincil.";
        medFeedback.className = "feedback info";
        return;
      }

      if (choice === s.med) {
        medFeedback.textContent =
          "Bu olguda ilaÃ§ aÃ§Ä±sÄ±ndan en uygun seÃ§enek: " + medLabel(choice) + ".";
        medFeedback.className = "feedback ok";
      } else {
        medFeedback.textContent =
          "Bu olguda Ã¶ncelikli ilaÃ§: " + medLabel(s.med) +
          ". " + medLabel(choice) + " ikinci planda veya farklÄ± bir endikasyonda.";
        medFeedback.className = "feedback bad";
      }
    }

    defibBtn.addEventListener("click", () => handleAction("defib"));
    cardioBtn.addEventListener("click", () => handleAction("cardioversion"));
    noShockBtn.addEventListener("click", () => handleAction("no-shock"));

    nextBtn.addEventListener("click", () => {
      if (currentIndex < SCENES.length - 1) {
        currentIndex++;
        renderScene();
      } else {
        resetTimer();
        timerLabel.textContent = "â€”";
        feedback.textContent =
          "SimÃ¼lasyon tamamlandÄ±. Toplam skorun: " + score +
          " puan. ZorlandÄ±ÄŸÄ±n olgularÄ± tartÄ±ÅŸmak iÃ§in bu ekranÄ± kullanabilirsin.";
        feedback.className = "feedback ok";
        progressFill.style.width = "100%";
        locked = true;
        nextBtn.disabled = true;
      }
    });

    restartBtn.addEventListener("click", () => {
      currentIndex = 0;
      score = 0;
      scoreValue.textContent = score;
      nextBtn.disabled = true;
      nextBtn.textContent = "Sonraki olguya geÃ§";
      timerLabel.textContent = (TIME_LIMIT_MS / 1000).toFixed(1);
      renderScene();
    });

    epiBtn.addEventListener("click", () => handleMed("epi"));
    mgBtn.addEventListener("click", () => handleMed("mg"));
    lidoBtn.addEventListener("click", () => handleMed("lido"));

    // BaÅŸlangÄ±Ã§
    renderScene();
  </script>
</body>
</html>