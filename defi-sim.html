<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Defi SimÃ¼latÃ¶rÃ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #020617;
      --card: #020617;
      --border: #1f2937;
      --accent: #22c55e;
      --danger: #f97373;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --heading: #f9fafb;
      --radius-lg: 18px;
      --radius-pill: 999px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 8px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0f172a 0, #020617 45%, #000 100%);
      color: var(--text);
      font-size: 15px;
    }

    .app {
      max-width: 480px;
      margin: 0 auto;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .brand {
      font-weight: 700;
      font-size: 1.05rem;
      color: var(--heading);
    }

    .pill {
      border-radius: var(--radius-pill);
      border: 1px solid var(--border);
      padding: 3px 9px;
      font-size: 0.78rem;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(15,23,42,0.9);
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 10px rgba(34,197,94,0.9);
    }

    .card {
      background: var(--card);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: 10px 10px;
      box-shadow: 0 14px 28px rgba(15, 23, 42, 0.9);
      margin-top: 8px;
    }

    /* MONÄ°TÃ–R */

    .monitor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      margin-bottom: 4px;
      color: var(--muted);
    }

    .monitor-label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .monitor-led {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 12px rgba(34,197,94,0.9);
      animation: led-pulse 1.4s ease-in-out infinite;
    }

    .monitor-screen {
      border-radius: 16px;
      background: #000000;
      border: 1px solid #0f172a;
      padding: 6px 8px;
      position: relative;
      overflow: hidden;
    }

    .grid {
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(rgba(15,23,42,0.55) 1px, transparent 1px),
        linear-gradient(90deg, rgba(15,23,42,0.55) 1px, transparent 1px);
      background-size: 0.5rem 0.5rem;
      opacity: 0.55;
      pointer-events: none;
    }

    .ekg-line {
      position: relative;
      height: 52px;
      overflow: hidden;
    }

    .ekg-line::after {
      content: "";
      position: absolute;
      inset: 0;
      background-repeat: repeat-x;
      background-size: 240px 60px;
      background-position: 0 0;
      animation: ekg-scroll 1.6s linear infinite;
      filter: drop-shadow(0 0 6px #22c55e);
    }

    /* Ritim gizli (hazÄ±rlÄ±k) */
    .ekg-off::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='60'%3E%3Cpolyline points='0,30 240,30' fill='none' stroke='%231f2937' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
      filter: none;
    }

    /* NSR */
    .ekg-nsr::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='60'%3E%3Cpolyline points='0,30 8,30 12,28 14,32 16,30 22,30 26,26 28,20 30,10 32,40 34,30 40,30 48,30 56,30 60,28 62,32 64,30 70,30 74,26 76,20 78,10 80,40 82,30 88,30 96,30 104,30 108,28 110,32 112,30 118,30 122,26 124,20 126,10 128,40 130,30 136,30 144,30 152,30 156,28 158,32 160,30 166,30 170,26 172,20 174,10 176,40 178,30 184,30 192,30 200,30 204,28 206,32 208,30 214,30 218,26 220,20 222,10 224,40 226,30 232,30 240,30' fill='none' stroke='%2322c55e' stroke-width='2' stroke-linejoin='round' stroke-linecap='round'/%3E%3C/svg%3E");
    }

    /* VF */
    .ekg-vf::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='60'%3E%3Cpolyline points='0,30 4,10 8,42 12,18 16,46 20,12 24,40 28,14 32,46 36,18 40,38 44,20 48,44 52,16 56,40 60,14 64,46 68,18 72,38 76,22 80,44 84,16 88,40 92,12 96,46 100,18 104,38 108,20 112,44 116,16 120,40 124,14 128,48 132,18 136,38 140,22 144,44 148,16 152,40 156,12 160,46 164,18 168,38 172,20 176,44 180,16 184,40 188,14 192,48 196,18 200,38 204,22 208,44 212,16 216,40 220,12 224,46 228,18 232,38 236,20 240,30' fill='none' stroke='%23f97373' stroke-width='1.8' stroke-linejoin='round' stroke-linecap='round'/%3E%3C/svg%3E");
    }

    /* pVT */
    .ekg-pvt::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='60'%3E%3Cpolyline points='0,30 6,12 12,48 18,12 24,48 30,12 36,48 42,12 48,48 54,12 60,48 66,12 72,48 78,12 84,48 90,12 96,48 102,12 108,48 114,12 120,48 126,12 132,48 138,12 144,48 150,12 156,48 162,12 168,48 174,12 180,48 186,12 192,48 198,12 204,48 210,12 216,48 222,12 228,48 234,12 240,30' fill='none' stroke='%23fb923c' stroke-width='2.1' stroke-linejoin='round' stroke-linecap='round'/%3E%3C/svg%3E");
    }

    /* Torsades */
    .ekg-torsades::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='60'%3E%3Cpolyline points='0,30 4,12 8,48 12,8 16,52 20,6 24,50 28,10 32,46 36,14 40,42 44,18 48,38 52,22 56,34 60,26 64,30 68,34 72,38 76,42 80,46 84,48 88,46 92,44 96,40 100,36 104,32 108,30 112,28 116,32 120,36 124,40 128,44 132,48 136,50 140,48 144,44 148,40 152,36 156,32 160,30 164,28 168,26 172,24 176,22 180,20 184,18 188,22 192,26 196,30 200,34 204,38 208,42 212,46 216,48 220,46 224,42 228,38 232,34 236,30 240,30' fill='none' stroke='%23fb7185' stroke-width='2' stroke-linejoin='round' stroke-linecap='round'/%3E%3C/svg%3E");
    }

    /* SVT tipi dÃ¼zenli taÅŸikardi */
    .ekg-tachy::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='60'%3E%3Cpolyline points='0,30 4,24 6,18 8,30 10,36 12,30 20,30 24,24 26,18 28,30 30,36 32,30 40,30 44,24 46,18 48,30 50,36 52,30 60,30 64,24 66,18 68,30 70,36 72,30 80,30 84,24 86,18 88,30 90,36 92,30 100,30 104,24 106,18 108,30 110,36 112,30 120,30 124,24 126,18 128,30 130,36 132,30 140,30 144,24 146,18 148,30 150,36 152,30 160,30 164,24 166,18 168,30 170,36 172,30 180,30 184,24 186,18 188,30 190,36 192,30 200,30 204,24 206,18 208,30 210,36 212,30 220,30 224,24 226,18 228,30 230,36 232,30 240,30' fill='none' stroke='%23facc15' stroke-width='1.9' stroke-linejoin='round' stroke-linecap='round'/%3E%3C/svg%3E");
    }

    /* HÄ±zlÄ± AF benzeri dÃ¼zensiz taÅŸikardi */
    .ekg-tachy-irreg::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='60'%3E%3Cpolyline points='0,30 4,26 6,20 8,32 10,28 12,30 18,30 22,22 24,16 26,34 28,30 30,32 36,30 40,24 42,18 44,32 46,28 48,30 54,30 58,20 60,16 62,36 64,30 66,32 72,30 76,26 78,18 80,34 82,30 84,32 90,30 94,22 96,18 98,34 100,30 102,32 108,30 112,24 114,20 116,32 118,28 120,30 126,30 130,22 132,16 134,34 136,30 138,32 144,30 148,26 150,18 152,34 154,30 156,32 162,30 166,24 168,20 170,32 172,28 174,30 180,30 184,22 186,16 188,34 190,30 192,32 198,30 202,26 204,18 206,34 208,30 210,32 216,30 220,24 222,20 224,32 226,28 228,30 234,30 238,22 240,30' fill='none' stroke='%2381a7ff' stroke-width='1.8' stroke-linejoin='round' stroke-linecap='round'/%3E%3C/svg%3E");
    }

    /* Asistol */
    .ekg-asystole::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='60'%3E%3Cpolyline points='0,30 240,30' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
    }

    /* PEA */
    .ekg-pea::after {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='60'%3E%3Cpolyline points='0,32 8,32 12,30 14,26 16,34 18,32 24,32 28,30 30,26 32,34 34,32 40,32 44,30 46,26 48,34 50,32 56,32 60,30 62,26 64,34 66,32 72,32 76,30 78,26 80,34 82,32 88,32 92,30 94,26 96,34 98,32 104,32 108,30 110,26 112,34 114,32 120,32 124,30 126,26 128,34 130,32 136,32 140,30 142,26 144,34 146,32 152,32 156,30 158,26 160,34 162,32 168,32 172,30 174,26 176,34 178,32 184,32 188,30 190,26 192,34 194,32 200,32 204,30 206,26 208,34 210,32 216,32 220,30 222,26 224,34 226,32 232,32 236,30 240,32' fill='none' stroke='%2393c5fd' stroke-width='1.6' stroke-linejoin='round' stroke-linecap='round'/%3E%3C/svg%3E");
    }

    .monitor-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.78rem;
      margin-top: 4px;
      color: var(--muted);
    }

    .tag {
      padding: 2px 8px;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border);
      font-size: 0.75rem;
    }
    .tag-postshock {
      border-color: #22c55e;
      color: #bbf7d0;
      background: rgba(34,197,94,0.18);
    }

    /* BUTONLAR */

    .controls {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 8px;
    }

    .btn {
      border: none;
      border-radius: var(--radius-pill);
      padding: 10px 12px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s ease-out;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      outline: none;
      width: 100%;
    }

    .btn-main {
      background: radial-gradient(circle at top left, #fb923c, #f97316);
      color: #0b1120;
      box-shadow: 0 10px 20px rgba(248,113,22,0.55);
    }
    .btn-main:active {
      transform: translateY(1px) scale(0.99);
    }

    .btn-cardio {
      background: radial-gradient(circle at top left, #38bdf8, #0ea5e9);
      color: #020617;
      box-shadow: 0 10px 20px rgba(56,189,248,0.55);
    }

    .btn-sec {
      background: rgba(15,23,42,0.95);
      border: 1px solid var(--border);
      color: var(--muted);
    }

    .btn-small {
      font-size: 0.8rem;
      padding: 6px 10px;
    }

    .btn[disabled] {
      opacity: 0.45;
      cursor: default;
      box-shadow: none;
    }

    .scenario-title {
      font-size: 0.92rem;
      color: var(--heading);
      margin-bottom: 3px;
    }

    .scenario-text {
      font-size: 0.88rem;
      color: var(--text);
      margin-bottom: 2px;
      max-height: 90px;
      overflow-y: auto;
    }

    .helper {
      font-size: 0.78rem;
      color: var(--muted);
      margin-top: 4px;
    }

    .meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      font-size: 0.8rem;
      margin-top: 4px;
      color: var(--muted);
    }

    .progress {
      margin-top: 6px;
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #22c55e, #4ade80);
      transform-origin: left;
      transition: width 0.25s ease-out;
    }

    /* Åok flash */

    .shock-flash {
      position: fixed;
      inset: 0;
      background: #ffffff;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.15s ease-out;
      z-index: 900;
    }

    /* MODAL (SonuÃ§) */

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.82);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 950;
      padding: 12px;
    }

    .modal {
      background: #020617;
      border-radius: 16px;
      border: 1px solid var(--border);
      padding: 12px 12px 10px;
      max-width: 420px;
      width: 100%;
      box-shadow: 0 18px 40px rgba(0,0,0,0.9);
      font-size: 0.9rem;
    }

    .modal-title {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .modal-title.ok { color: var(--accent); }
    .modal-title.bad { color: var(--danger); }

    .modal-body {
      font-size: 0.88rem;
      color: var(--text);
      margin-bottom: 8px;
      max-height: 140px;
      overflow-y: auto;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .feedback {
      margin-top: 4px;
      font-size: 0.8rem;
      color: var(--muted);
    }

    /* Animasyonlar */

    @keyframes ekg-scroll {
      from { background-position: 0 0; }
      to   { background-position: -240px 0; }
    }

    @keyframes led-pulse {
      0%, 100% { transform: scale(1); opacity: 0.9; }
      50% { transform: scale(1.25); opacity: 1; }
    }

    /* Daha dar ekran ayarÄ± */
    @media (max-height: 700px) {
      .scenario-text {
        max-height: 80px;
      }
    }
  </style>
</head>
<body>
  <div class="shock-flash" id="shockFlash"></div>

  <!-- MODAL -->
  <div class="modal-backdrop" id="resultBackdrop">
    <div class="modal">
      <div id="modalTitle" class="modal-title">SonuÃ§</div>
      <div id="modalBody" class="modal-body">
        AÃ§Ä±klama buraya gelecek.
      </div>
      <div class="modal-footer">
        <button id="modalNextBtn" class="btn btn-small btn-main">Sonraki olgu</button>
      </div>
    </div>
  </div>

  <div class="app">
    <div class="top-bar">
      <div class="brand">Defi SimÃ¼latÃ¶rÃ¼</div>
      <div class="pill">
        <span class="pill-dot"></span>
        Ritim tanÄ± â€“ 5 sn
      </div>
    </div>

    <!-- MONÄ°TÃ–R -->
    <div class="card">
      <div class="monitor-header">
        <div class="monitor-label">
          <span class="monitor-led"></span>
          <span>Lead II</span>
        </div>
        <div>
          HR: <span id="rateLabel">â€“</span> â€¢
          SÃ¼re: <span id="timerLabel">â€”</span> sn
        </div>
      </div>

      <div class="monitor-screen">
        <div class="grid"></div>
        <div id="ekgLine" class="ekg-line ekg-off"></div>
      </div>

      <div class="monitor-footer">
        <span id="phaseLabel" class="tag">Olgu hazÄ±rlÄ±k</span>
        <span id="modeHint" class="tag">Ritim gizli â€“ baÅŸlatÄ±nca gÃ¶zÃ¼kecek</span>
      </div>
    </div>

    <!-- SKOR / Ä°LERLEME -->
    <div class="card">
      <div class="meta-row">
        <span class="pill">
          Skor: <strong id="scoreValue">0</strong> puan
        </span>
        <span class="pill">
          Olgu: <span id="sceneIndex">1</span>/<span id="sceneTotal">1</span>
        </span>
      </div>
      <div class="progress">
        <div id="progressFill" class="progress-fill"></div>
      </div>
    </div>

    <!-- OLGU & KONTROL -->
    <div class="card">
      <div class="scenario-title" id="scenarioTitle">
        Olgu 1
      </div>
      <div class="scenario-text" id="scenarioText">
        Senaryo yÃ¼kleniyor...
      </div>

      <div class="controls">
        <button id="startBtn" class="btn btn-sec">
          â–¶ Ritmi gÃ¶ster & sÃ¼reyi baÅŸlat
        </button>
        <button id="defibBtn" class="btn btn-main" disabled>
          âš¡ Defibrilasyon (200 J)
        </button>
        <button id="cardioBtn" class="btn btn-cardio" disabled>
          âš¡ Senkron kardiyoversiyon
        </button>
        <button id="noShockBtn" class="btn btn-sec" disabled>
          ğŸ¤š Åok yok / KPR / ilaÃ§
        </button>
      </div>

      <div class="helper">
        Ä°leri seviye (opsiyonel): Bu olguda hangi ilaÃ§ Ã¶ncelikli?
      </div>
      <div class="controls" style="gap:4px; margin-top:4px;">
        <button id="epiBtn" class="btn btn-small btn-sec">ğŸ’Š Adrenalin</button>
        <button id="mgBtn" class="btn btn-small btn-sec">ğŸ’Š Magnezyum</button>
        <button id="lidoBtn" class="btn btn-small btn-sec">ğŸ’Š Lidokain / Amiodaron</button>
      </div>
      <div id="medFeedback" class="feedback">
        Ä°laÃ§ seÃ§imi puanÄ± deÄŸiÅŸtirmez, sadece geri bildirim verir.
      </div>
    </div>

    <!-- RESET -->
    <div class="card">
      <div class="scenario-title">Oturumu sÄ±fÄ±rla</div>
      <div class="helper">
        Bu araÃ§, gerÃ§ek hasta yÃ¶netiminin yerini tutmaz. ALS algoritmasÄ±nÄ± tartÄ±ÅŸmak
        iÃ§in oyunlaÅŸtÄ±rÄ±lmÄ±ÅŸ bir simÃ¼lasyondur.
      </div>
      <div class="controls" style="margin-top:6px;">
        <button id="restartBtn" class="btn btn-small btn-sec">
          ğŸ” BaÅŸtan baÅŸlat
        </button>
      </div>
    </div>
  </div>

  <script>
    const TIME_LIMIT_MS = 5000;

    // Olgu metinleri: ritim ipucu yok, paramedik/hemÅŸire sunumu gibi
    const SCENES = [
      {
        id: 1,
        title: "Olgu 1 â€“ Ani kollaps",
        text:
          "65 yaÅŸ erkek, acil serviste triya j sÄ±rasÄ±nda aniden yere yÄ±ÄŸÄ±lÄ±yor. Bilinci kapalÄ±, solunum normal deÄŸil, palpabl nabÄ±z alÄ±namÄ±yor. Ekip olarak KPR baÅŸlatÄ±yorsunuz ve monitÃ¶re baÄŸlanÄ±yorsunuz.",
        wave: "vf",
        hr: "â€”",
        phase: "ResÃ¼sitasyon",
        correctAction: "defib",
        convertToNSR: true,
        postHr: "90",
        med: "lido",
        explanationOk:
          "Ani kollaps, nabÄ±zsÄ±z hasta ve ÅŸoklanabilir ritim varlÄ±ÄŸÄ± defibrilasyon endikasyonudur. ERC 2025 ALS: MÃ¼mkÃ¼n olan en kÄ±sa sÃ¼rede defibrilasyon, ardÄ±ndan 2 dk kesintisiz KPR.",
        explanationBad:
          "NabÄ±zsÄ±z, ritmi ÅŸoklanabilir bir tabloda geciken veya atlanan defibrilasyon prognozu kÃ¶tÃ¼leÅŸtirir. Bu olguda Ã¶ncelik defibrilasyondur."
      },
      {
        id: 2,
        title: "Olgu 2 â€“ Åok sonrasÄ± deÄŸerlendirme",
        text:
          "AynÄ± hastaya bir ÅŸok uygulandÄ± ve 2 dk KPR yapÄ±ldÄ±. Åimdi kÄ±sa ritim kontrolÃ¼ndesiniz. MonitÃ¶re bakarken hasta gÃ¶zlerini aÃ§Ä±yor, komut alÄ±yor ve hareket etmeye baÅŸlÄ±yor.",
        wave: "nsr",
        hr: "80",
        phase: "Åok sonrasÄ± kontrol",
        correctAction: "no-shock",
        convertToNSR: false,
        med: null,
        explanationOk:
          "Klinik iyileÅŸme ve organize bir dolaÅŸÄ±m bulgusu varken ek ÅŸok uygulanmaz. Bundan sonra hemodinamik deÄŸerlendirme, oksijenlenme ve ileri tedavi planlanÄ±r.",
        explanationBad:
          "Åok sonrasÄ± hasta belirgin toparlamÄ±ÅŸken tekrar defibrilasyon yapmak gereksiz ve zararlÄ± olabilir; odak hemodinamik stabilizasyon olmalÄ±dÄ±r."
      },
      {
        id: 3,
        title: "Olgu 3 â€“ GenÃ§ eriÅŸkin, hipotansif taÅŸikardi",
        text:
          "35 yaÅŸ kadÄ±n, Ã§arpÄ±ntÄ± ve baÅŸ dÃ¶nmesi ÅŸikÃ¢yetiyle getiriliyor. TA 70/40 mmHg, soÄŸuk ve soluk, hafif bilinÃ§ bulanÄ±klÄ±ÄŸÄ± var. NabÄ±z Ã§ok hÄ±zlÄ± ve dÃ¼zenli hissediliyor.",
        wave: "tachy",
        hr: "190",
        phase: "NabÄ±zlÄ± taÅŸikardi",
        correctAction: "cardioversion",
        convertToNSR: true,
        postHr: "90",
        med: null,
        explanationOk:
          "Hemodinamik olarak instabil, nabÄ±zlÄ± taÅŸikardide senkron kardiyoversiyon endikedir. Ä°laÃ§larla oyalanmak veya sadece izlemek yerine ritmin elektriksel olarak dÃ¼zeltilmesi gerekir.",
        explanationBad:
          "Bu klinik tabloda defibrilasyon modu veya sadece farmakolojik yaklaÅŸÄ±m yetersiz olabilir; hemodinamik instabil taÅŸikardide senkron kardiyoversiyon ilk seÃ§enektir."
      },
      {
        id: 4,
        title: "Olgu 4 â€“ YaÅŸlÄ± hasta, kronik aritmi Ã¶ykÃ¼sÃ¼",
        text:
          "72 yaÅŸ erkek, uzun sÃ¼redir dÃ¼zensiz kalp atÄ±mÄ± Ã¶ykÃ¼sÃ¼ var. Åimdi gÃ¶ÄŸÃ¼s aÄŸrÄ±sÄ±, nefes darlÄ±ÄŸÄ± ve sersemlik hissi ile getiriliyor. TA 80/50 mmHg, soÄŸuk terli, nabÄ±z Ã§ok hÄ±zlÄ± ve dÃ¼zensiz.",
        wave: "tachy-irreg",
        hr: "150",
        phase: "NabÄ±zlÄ± taÅŸikardi",
        correctAction: "cardioversion",
        convertToNSR: true,
        postHr: "90",
        med: null,
        explanationOk:
          "Daha Ã¶nce aritmi Ã¶ykÃ¼sÃ¼ olan bu hastada, ÅŸu anda belirgin hipotansiyon ve semptom var. Hemodinamik instabil dÃ¼zensiz taÅŸikardilerde acil senkron kardiyoversiyon endikedir.",
        explanationBad:
          "Bu durumda sadece hÄ±z dÃ¼ÅŸÃ¼rÃ¼cÃ¼ ilaÃ§larla zaman kaybetmek uygun deÄŸildir; klinik instabilite karÅŸÄ±sÄ±nda elektriksel kardiyoversiyon geciktirilmemelidir."
      },
      {
        id: 5,
        title: "Olgu 5 â€“ NabÄ±zsÄ±z, elektriksel aktivite belirsiz",
        text:
          "Acilde yatan bir hastaya Ã§aÄŸrÄ±lÄ±yorsunuz. YataÄŸÄ±nda yanÄ±tsÄ±z, normal solumuyor ve palpabl nabÄ±z alÄ±namÄ±yor. Ekip KPR baÅŸlatÄ±yor, sen monitÃ¶re bakarak ritmi yorumluyorsun.",
        wave: "asystole",
        hr: "0",
        phase: "Arrest deÄŸerlendirme",
        correctAction: "no-shock",
        convertToNSR: false,
        med: "epi",
        explanationOk:
          "Åoklanamaz arrest tablolarÄ±nda tedavi; yÃ¼ksek kaliteli KPR, adrenalin uygulamasÄ± ve geri dÃ¶nÃ¼ÅŸebilir nedenlerin (4H/4T) dÃ¼zeltilmesidir. Bu durumda defibrilasyon endikasyonu yoktur.",
        explanationBad:
          "Åoklanamaz ritimlerde defibrilasyon sadece KPR'yi keser ve zaman kaybettirir. Bu tabloda ÅŸok deÄŸil; KPR, adrenalin ve nedenlerin dÃ¼zeltilmesi Ã¶n plandadÄ±r."
      },
      {
        id: 6,
        title: "Olgu 6 â€“ NabÄ±z yok, monitÃ¶rde elektriksel aktivite",
        text:
          "Ä°leri yaÅŸ bir hasta, serviste ani kÃ¶tÃ¼leÅŸme sonrasÄ± acile alÄ±nÄ±yor. MonitÃ¶rde bir ritim gÃ¶rÃ¼yorsunuz ancak ne radial ne de femoral nabÄ±z palpe edemiyorsunuz. Hasta yanÄ±tsÄ±z ve apneik.",
        wave: "pea",
        hr: "40",
        phase: "Arrest deÄŸerlendirme",
        correctAction: "no-shock",
        convertToNSR: false,
        med: "epi",
        explanationOk:
          "Bu tablo nabÄ±zsÄ±z elektriksel aktivite ile uyumludur ve ÅŸoklanamaz arrest olarak kabul edilir. Tedavi; KPR, adrenalin ve 4H/4T baÅŸta olmak Ã¼zere altta yatan nedenlere yÃ¶nelik yaklaÅŸÄ±mdÄ±r.",
        explanationBad:
          "Elektriksel aktivite gÃ¶rÃ¼ldÃ¼ÄŸÃ¼ iÃ§in refleks olarak ÅŸok vermek isteyebilirsiniz ancak PEA ÅŸoklanamaz bir ritimdir. Åok yerine KPR ve nedene yÃ¶nelik tedavi esastÄ±r."
      },
      {
        id: 7,
        title: "Olgu 7 â€“ GeniÅŸ kompleks, nabÄ±z alÄ±namÄ±yor",
        text:
          "50 yaÅŸ erkek, gÃ¶ÄŸÃ¼s aÄŸrÄ±sÄ± hikÃ¢yesi sonrasÄ± aniden bilincini kaybediyor. Olay yerinde ve acilde nabÄ±z alÄ±namÄ±yor. MonitÃ¶rde hÄ±zlÄ±, geniÅŸ kompleksli bir elektriksel aktivite gÃ¶rÃ¼yorsun.",
        wave: "pvt",
        hr: "160",
        phase: "ResÃ¼sitasyon",
        correctAction: "defib",
        convertToNSR: true,
        postHr: "90",
        med: "lido",
        explanationOk:
          "NabÄ±zsÄ±z, geniÅŸ kompleksli ve dÃ¼zenli ritim nabÄ±zsÄ±z VT ile uyumludur ve ÅŸoklanabilir. Defibrilasyon + ardÄ±ndan 2 dk KPR, uygun zamanda adrenalin ve amiodaron/lidokain Ã¶nerilir.",
        explanationBad:
          "Bu tabloda defibrilasyondan kaÃ§Ä±nmak veya sadece KPR/ilaÃ§la yetinmek uygun deÄŸildir; nabÄ±zsÄ±z VT ÅŸoklanabilir bir ritimdir ve gecikme prognozu bozar."
      },
      {
        id: 8,
        title: "Olgu 8 â€“ UzamÄ±ÅŸ QT Ã¶ykÃ¼lÃ¼ hasta, Ã§Ã¶kÃ¼ÅŸ sonrasÄ±",
        text:
          "UzamÄ±ÅŸ QT Ã¶ykÃ¼sÃ¼ olduÄŸu bilinen bir hasta, gÃ¶ÄŸÃ¼s Ã§arpÄ±ntÄ±sÄ± sonrasÄ± ani olarak bilincini kaybediyor. NabÄ±z alÄ±namÄ±yor. MonitÃ¶rde, ÅŸekli zaman iÃ§inde deÄŸiÅŸen hÄ±zlÄ± bir ritim gÃ¶rÃ¼yorsun.",
        wave: "torsades",
        hr: "220",
        phase: "ResÃ¼sitasyon",
        correctAction: "defib",
        convertToNSR: true,
        postHr: "90",
        med: "mg",
        explanationOk:
          "UzamÄ±ÅŸ QT Ã¶ykÃ¼sÃ¼ olan bu hastada nabÄ±zsÄ±z, polimorfik VT tablosu torsades de pointes ile uyumludur. Defibrilasyonun yanÄ± sÄ±ra magnezyum replasmanÄ± da Ã¶nemlidir.",
        explanationBad:
          "Torsadesâ€™te sadece adrenalin veya lidokainle yetinmek yetersizdir; nabÄ±zsÄ±z tabloda defibrilasyon + magnezyum tedavisi gerekir."
      }
    ];

    const ekgLine = document.getElementById("ekgLine");
    const rateLabel = document.getElementById("rateLabel");
    const phaseLabel = document.getElementById("phaseLabel");
    const modeHint = document.getElementById("modeHint");
    const timerLabel = document.getElementById("timerLabel");

    const scenarioTitle = document.getElementById("scenarioTitle");
    const scenarioText = document.getElementById("scenarioText");
    const scoreValue = document.getElementById("scoreValue");
    const sceneIndex = document.getElementById("sceneIndex");
    const sceneTotal = document.getElementById("sceneTotal");
    const progressFill = document.getElementById("progressFill");
    const medFeedback = document.getElementById("medFeedback");

    const startBtn = document.getElementById("startBtn");
    const defibBtn = document.getElementById("defibBtn");
    const cardioBtn = document.getElementById("cardioBtn");
    const noShockBtn = document.getElementById("noShockBtn");
    const restartBtn = document.getElementById("restartBtn");
    const shockFlash = document.getElementById("shockFlash");

    const epiBtn = document.getElementById("epiBtn");
    const mgBtn = document.getElementById("mgBtn");
    const lidoBtn = document.getElementById("lidoBtn");

    const resultBackdrop = document.getElementById("resultBackdrop");
    const modalTitle = document.getElementById("modalTitle");
    const modalBody = document.getElementById("modalBody");
    const modalNextBtn = document.getElementById("modalNextBtn");

    let currentIndex = 0;
    let score = 0;
    let locked = false;
    let hasStarted = false;
    let timerInterval = null;
    let deadline = null;
    const baseTimerColor = getComputedStyle(timerLabel).color;

    sceneTotal.textContent = SCENES.length;

    function setAnswerButtonsDisabled(disabled) {
      defibBtn.disabled = disabled;
      cardioBtn.disabled = disabled;
      noShockBtn.disabled = disabled;
    }

    function updateMonitorPre(scene) {
      ekgLine.className = "ekg-line ekg-off";
      rateLabel.textContent = scene.hr ? scene.hr : "â€“";
      phaseLabel.textContent = "Olgu hazÄ±rlÄ±k";
      modeHint.textContent = "Ritim gizli â€“ baÅŸlatÄ±nca gÃ¶zÃ¼kecek";
      modeHint.className = "tag";
    }

    function updateMonitorActive(scene, fromShockSuccess = false) {
      ekgLine.className = "ekg-line";
      ekgLine.classList.add("ekg-" + (scene.wave || "nsr"));

      rateLabel.textContent = scene.hr ? scene.hr : "â€“";
      phaseLabel.textContent = scene.phase || "";

      if (fromShockSuccess && (scene.wave === "nsr" || scene.wave === undefined)) {
        modeHint.textContent = "Ritim organize oldu";
        modeHint.className = "tag tag-postshock";
      } else {
        modeHint.textContent = "Ritim ekranÄ±";
        modeHint.className = "tag";
      }
    }

    function resetTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      timerLabel.style.color = baseTimerColor;
    }

    function startTimer() {
      resetTimer();
      deadline = Date.now() + TIME_LIMIT_MS;
      timerLabel.style.color = baseTimerColor;

      function tick() {
        if (locked || !hasStarted) {
          resetTimer();
          return;
        }
        const now = Date.now();
        const remaining = deadline - now;
        if (remaining <= 0) {
          resetTimer();
          timerLabel.textContent = "0.0";
          timerLabel.style.color = baseTimerColor;
          handleTimeout();
        } else {
          const sec = remaining / 1000;
          timerLabel.textContent = sec.toFixed(1);
          if (sec <= 2) {
            timerLabel.style.color = "#f97373";
          } else {
            timerLabel.style.color = baseTimerColor;
          }
        }
      }

      timerLabel.textContent = (TIME_LIMIT_MS / 1000).toFixed(1);
      timerInterval = setInterval(tick, 100);
    }

    function renderScene() {
      const s = SCENES[currentIndex];
      sceneIndex.textContent = currentIndex + 1;
      scenarioTitle.textContent = s.title;
      scenarioText.textContent = s.text;

      const progress = (currentIndex / SCENES.length) * 100;
      progressFill.style.width = progress + "%";

      medFeedback.textContent = "Ä°laÃ§ seÃ§imi puanÄ± deÄŸiÅŸtirmez, sadece geri bildirim verir.";
      medFeedback.className = "feedback";

      locked = false;
      hasStarted = false;
      startBtn.disabled = false;
      setAnswerButtonsDisabled(true);

      resetTimer();
      timerLabel.textContent = "â€”";

      updateMonitorPre(s);
    }

    function triggerShockFlash(actionType) {
      shockFlash.style.background = actionType === "cardioversion" ? "#e0f2fe" : "#ffffff";
      shockFlash.style.opacity = "1";
      setTimeout(() => {
        shockFlash.style.opacity = "0";
      }, 120);
    }

    function openResultModal(isCorrect, text, isLast) {
      modalTitle.textContent = isCorrect ? "DoÄŸru yaklaÅŸÄ±m" : "YanlÄ±ÅŸ / Eksik yaklaÅŸÄ±m";
      modalTitle.className = "modal-title " + (isCorrect ? "ok" : "bad");
      modalBody.textContent = text;
      modalNextBtn.textContent = isLast ? "Oturumu bitir" : "Sonraki olgu";
      resultBackdrop.style.display = "flex";
    }

    function closeResultModal() {
      resultBackdrop.style.display = "none";
    }

    function handleAction(actionType) {
      if (locked || !hasStarted) return;
      const s = SCENES[currentIndex];
      locked = true;
      setAnswerButtonsDisabled(true);
      startBtn.disabled = true;
      resetTimer();

      const isCorrect = actionType === s.correctAction;
      let delta = 0;

      if (isCorrect) {
        delta = 10;
        score += delta;
      } else {
        delta = -5;
        score += delta;
        if (score < 0) score = 0;
      }
      scoreValue.textContent = score;

      if (actionType === "defib" || actionType === "cardioversion") {
        triggerShockFlash(actionType);

        if (s.convertToNSR && isCorrect) {
          setTimeout(() => {
            const postScene = { wave: "nsr", hr: s.postHr || "80", phase: "Åok sonrasÄ±" };
            updateMonitorActive(postScene, true);
          }, 350);
        }
      }

      const explanation = isCorrect ? (s.explanationOk || "DoÄŸru.") : (s.explanationBad || "YanlÄ±ÅŸ karar.");
      const isLast = currentIndex === SCENES.length - 1;
      openResultModal(isCorrect, explanation, isLast);
    }

    function describeActionKey(key) {
      if (key === "defib") return "defibrilasyon";
      if (key === "cardioversion") return "senkron kardiyoversiyon";
      if (key === "no-shock") return "ÅŸok yok / KPR / ilaÃ§";
      return "uygun yaklaÅŸÄ±m";
    }

    function handleTimeout() {
      if (locked || !hasStarted) return;
      locked = true;
      setAnswerButtonsDisabled(true);
      startBtn.disabled = true;

      const s = SCENES[currentIndex];
      const correctText = describeActionKey(s.correctAction);
      const msg =
        "SÃ¼re doldu. Bu olguda doÄŸru yaklaÅŸÄ±m: " +
        correctText + ". " + (s.explanationOk || "");
      const isLast = currentIndex === SCENES.length - 1;
      openResultModal(false, msg, isLast);
    }

    function medLabel(code) {
      if (code === "epi") return "adrenalin";
      if (code === "mg") return "magnezyum";
      if (code === "lido") return "amiodaron / lidokain";
      return "uygun ilaÃ§";
    }

    function handleMed(choice) {
      const s = SCENES[currentIndex];
      if (!s.med) {
        medFeedback.textContent =
          "Bu olguda asÄ±l kritik olan enerji stratejisi (defi/kardiyoversiyon); ilaÃ§ ikincil sÄ±radadÄ±r.";
        medFeedback.className = "feedback";
        return;
      }

      if (choice === s.med) {
        medFeedback.textContent =
          "Bu olguda ilaÃ§ aÃ§Ä±sÄ±ndan en uygun seÃ§enek: " + medLabel(choice) + ".";
        medFeedback.className = "feedback";
        medFeedback.style.color = "#22c55e";
      } else {
        medFeedback.textContent =
          "Bu olguda Ã¶ncelikli ilaÃ§: " + medLabel(s.med) +
          ". " + medLabel(choice) + " ikincil veya farklÄ± endikasyonda dÃ¼ÅŸÃ¼nÃ¼lÃ¼r.";
        medFeedback.className = "feedback";
        medFeedback.style.color = "#f97373";
      }
    }

    startBtn.addEventListener("click", () => {
      if (hasStarted) return;
      hasStarted = true;
      startBtn.disabled = true;
      setAnswerButtonsDisabled(false);
      const s = SCENES[currentIndex];
      updateMonitorActive(s);
      startTimer();
    });

    defibBtn.addEventListener("click", () => handleAction("defib"));
    cardioBtn.addEventListener("click", () => handleAction("cardioversion"));
    noShockBtn.addEventListener("click", () => handleAction("no-shock"));

    modalNextBtn.addEventListener("click", () => {
      closeResultModal();
      if (currentIndex < SCENES.length - 1) {
        currentIndex++;
        renderScene();
      } else {
        // Oturum bitti
        resetTimer();
        timerLabel.textContent = "â€”";
        phaseLabel.textContent = "Oturum tamamlandÄ±";
        modeHint.textContent = "Toplam skor: " + score + " puan";
        modeHint.className = "tag tag-postshock";
        setAnswerButtonsDisabled(true);
        startBtn.disabled = true;
      }
    });

    resultBackdrop.addEventListener("click", (e) => {
      if (e.target === resultBackdrop) {
        // backdrop'a tÄ±klayÄ±nca, sadece aÃ§Ä±klamayÄ± gÃ¶rsÃ¼n diye kapatmayalÄ±m
        // istersek ileride kapatma eklenir
      }
    });

    restartBtn.addEventListener("click", () => {
      currentIndex = 0;
      score = 0;
      scoreValue.textContent = score;
      renderScene();
    });

    epiBtn.addEventListener("click", () => handleMed("epi"));
    mgBtn.addEventListener("click", () => handleMed("mg"));
    lidoBtn.addEventListener("click", () => handleMed("lido"));

    // BaÅŸlangÄ±Ã§
    renderScene();
  </script>
</body>
</html>